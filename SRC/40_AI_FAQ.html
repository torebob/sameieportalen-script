<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="utf-8">
    <title>AI-basert FAQ</title>
    <base target="_top">
    <style>
      :root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--border:#1f2937;--primary:#3b82f6;--success:#10b981;--warning:#f59e0b;--danger:#ef4444}
      *{box-sizing:border-box}
      body{margin:0;padding:12px;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,system-ui,sans-serif;background:var(--bg);color:#fff;line-height:1.5}
      main {max-width: 800px; margin: 20px auto; padding: 20px; background-color: var(--card); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,.3);}
      h1 { border-bottom: 1px solid var(--border); padding-bottom: 8px; }
      #search-input { width: 100%; padding: 12px; font-size: 16px; border-radius: 6px; border: 1px solid var(--border); background-color: var(--bg); color: #fff; }
      #search-btn { width: 100%; padding: 12px; font-size: 16px; border-radius: 6px; border: none; background-color: var(--primary); color: #fff; cursor: pointer; margin-top: 10px; }
      #search-btn:disabled { background-color: var(--muted); cursor: not-allowed; }
      #results-container { margin-top: 20px; }
      .result-item { border-bottom: 1px solid var(--border); padding: 15px 0; }
      .result-item:last-child { border-bottom: none; }
      .result-question { font-weight: bold; color: var(--primary); }
      .result-answer { margin-top: 8px; color: var(--muted); }
      .loader { text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <main>
        <h1>AI-basert FAQ</h1>
        <p>Still et spørsmål om sameiets dokumenter og regelverk.</p>
        <input type="text" id="search-input" placeholder="Skriv inn ditt spørsmål her...">
        <button id="search-btn">Søk</button>
        <div id="results-container"></div>
    </main>

    <script>
      const FAQ_App = {
        init() {
          this.searchInput = document.getElementById('search-input');
          this.searchBtn = document.getElementById('search-btn');
          this.resultsContainer = document.getElementById('results-container');
          this.setupEventListeners();
        },
        setupEventListeners() {
          this.searchBtn.addEventListener('click', () => this.performSearch());
          this.searchInput.addEventListener('keyup', e => {
            if (e.key === 'Enter') this.performSearch();
          });
        },
        performSearch() {
          const query = this.searchInput.value.trim();
          if (!query) {
            this.showNotification('Vennligst skriv inn et spørsmål.', 'warning');
            return;
          }

          this.setLoading(true);
          google.script.run
            .withSuccessHandler(results => {
              this.setLoading(false);
              this.displayResults(results);
            })
            .withFailureHandler(error => {
              this.setLoading(false);
              this.showNotification('Feil: ' + (error?.message || error), 'error');
              console.error(error);
            })
            .searchFAQ(query);
        },
        setLoading(isLoading) {
          this.searchBtn.disabled = isLoading;
          this.searchInput.disabled = isLoading;
          if (isLoading) {
            this.resultsContainer.innerHTML = '<div class="loader">Søker...</div>';
          }
        },
        displayResults(results) {
          this.resultsContainer.innerHTML = '';
          if (!results || results.length === 0) {
            this.resultsContainer.innerHTML = '<p>Ingen relevante resultater funnet.</p>';
            return;
          }

          results.forEach(item => {
            const resultEl = document.createElement('div');
            resultEl.className = 'result-item';
            resultEl.innerHTML = `
              <div class="result-question">${item.question}</div>
              <div class="result-answer">${item.answer}</div>
            `;
            this.resultsContainer.appendChild(resultEl);
          });
        },
        showNotification(message, type = 'info') {
          // Placeholder for a more robust notification system
          alert(message);
        }
      };
      document.addEventListener('DOMContentLoaded', () => FAQ_App.init());
    </script>
</body>
</html>