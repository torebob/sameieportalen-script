<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="utf-8">
    <title><?= appName ?> Dashboard</title>
    <base target="_top">
    <style>
      :root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--border:#1f2937;--primary:#3b82f6;--success:#10b981;--warning:#f59e0b;--danger:#ef4444}
      *{box-sizing:border-box}
      body{margin:0;padding:12px;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,system-ui,sans-serif;background:var(--bg);color:#fff;line-height:1.5}
      header, main {max-width: 800px; margin: 0 auto;}
      .btn{border:1px solid var(--border);background:var(--card);color:#e2e8f0;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s ease;text-decoration:none;display:inline-flex;align-items:center;gap:6px}
      .btn:hover:not(:disabled){background:var(--primary);border-color:var(--primary);transform:translateY(-1px)}
      .btn:disabled{opacity:.5;cursor:not-allowed}
      .btn.success{background-color: var(--success); border-color: var(--success);}
      .badge{font-size:12px;color:var(--muted)}
      .btn-group{display:flex;flex-wrap:wrap;gap:8px; margin-top: 1rem;}
      h1 { border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    </style>
</head>
<body>
    <header>
        <h1>Dashboard</h1>
    </header>
    <main>
        <p>Innlogget som: <b><?= userInfo.email || 'Ukjent' ?></b></p>

        <div class="btn-group">
            <a href="<?= appUrlBase ?>?page=ai_assistent" class="btn">AI Assistent</a>
        </div>

        <? if (isAdmin && adminButtons && adminButtons.length > 0) { ?>
            <div class="btn-group">
                <? adminButtons.forEach(button => { ?>
                    <button class="btn admin-btn <?= button.class || '' ?>" data-action="<?= button.action ?>">
                        <?= button.label ?>
                    </button>
                <? }) ?>
            </div>
        <? } else if (isAdmin) { ?>
            <span class="badge">Ingen admin-handlinger er konfigurert.</span>
        <? } ?>

    </main>

    <script>
      const Dashboard = {
        init() {
          this.setupEventListeners();
        },
        setupEventListeners() {
          document.querySelectorAll('.admin-btn').forEach(btn => {
            btn.addEventListener('click', e => this.handleAdminAction(e.currentTarget.dataset.action, e.currentTarget));
          });
        },
        handleAdminAction(action, button) {
          if (!action || button.disabled) return;
          const originalText = button.textContent;
          button.disabled = true;
          button.textContent = 'Arbeider...';
          google.script.run
            .withSuccessHandler(msg => {
              button.disabled = false;
              button.textContent = originalText;
              this.showNotification(msg || 'UtfÃ¸rt!', 'success');
            })
            .withFailureHandler(error => {
              button.disabled = false;
              button.textContent = originalText;
              this.showNotification('Feil: ' + (error?.message || error), 'error');
              console.error(error);
            })[action]();
        },
        showNotification(message, type = 'info') {
          const el = document.createElement('div');
          el.textContent = message;
          el.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'primary'});
            color: #fff;
            padding: 12px 16px;
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,.3);
            transition: opacity 0.3s ease;
          `;
          document.body.appendChild(el);
          setTimeout(() => {
            el.style.opacity = '0';
            setTimeout(() => el.remove(), 300);
          }, 3000);
        }
      };
      document.addEventListener('DOMContentLoaded', () => Dashboard.init());
    </script>
</body>
</html>