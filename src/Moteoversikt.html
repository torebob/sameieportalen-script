<!--
FIL: Moteoversikt.html
FORMÅL: Viser en oversikt over styremøter. Henter data dynamisk.
-->
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-800">Møter & Protokoller</h1>
        <button onclick="openNewMeetingModal()" class="rounded-md bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary/80">
            Planlegg nytt møte
        </button>
    </div>

    <!-- Seksjon for kommende møter -->
    <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Kommende møter</h2>
        <div id="kommende-moter-liste" class="rounded-lg border bg-white shadow-sm">
            <!-- Innhold lastes dynamisk av JavaScript -->
            <p class="p-6 text-gray-500">Laster møter...</p>
        </div>
    </div>

    <!-- Seksjon for tidligere møter -->
    <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Arkiv (Tidligere møter)</h2>
        <div id="tidligere-moter-liste" class="rounded-lg border bg-white shadow-sm">
            <!-- Innhold lastes dynamisk av JavaScript -->
            <p class="p-6 text-gray-500">Laster arkiv...</p>
        </div>
    </div>
</div>

<script>
    /**
     * Kjøres når denne siden lastes inn. Henter og viser møtedata.
     */
    function meetingspageInit() {
        console.log("meetings-page.html initialisert.");
        
        callServer('getMeetings')
            .then(function(meetings) {
                renderMeetingLists(meetings);
            })
            .catch(function(error) {
                console.error("Klarte ikke hente møter:", error);
                document.getElementById('kommende-moter-liste').innerHTML = `<p class="p-6 text-red-600">Kunne ikke laste møtedata. Sjekk konsollen for feil.</p>`;
                document.getElementById('tidligere-moter-liste').innerHTML = '';
            });
    }

    /**
     * Sorterer og viser møtene i riktige lister på siden.
     * @param {Array<Object>} meetings - En liste med møteobjekter fra serveren.
     */
    function renderMeetingLists(meetings) {
        const kommendeListen = document.getElementById('kommende-moter-liste');
        const tidligereListen = document.getElementById('tidligere-moter-liste');
        
        kommendeListen.innerHTML = ''; // Tømmer laste-tekst
        tidligereListen.innerHTML = ''; // Tømmer laste-tekst

        const now = new Date();
        const kommendeMoter = meetings.filter(m => new Date(m.dato) >= now);
        const tidligereMoter = meetings.filter(m => new Date(m.dato) < now);

        if (kommendeMoter.length > 0) {
            kommendeMoter.forEach(mote => kommendeListen.appendChild(createMeetingCard(mote)));
        } else {
            kommendeListen.innerHTML = `<p class="p-6 text-gray-500">Ingen planlagte møter.</p>`;
        }

        if (tidligereMoter.length > 0) {
            tidligereMoter.forEach(mote => tidligereListen.appendChild(createMeetingCard(mote, true)));
        } else {
            tidligereListen.innerHTML = `<p class="p-6 text-gray-500">Ingen tidligere møter i arkivet.</p>`;
        }
    }

    /**
     * Oppretter et HTML-element for et enkelt møte.
     * @param {Object} mote - Møteobjektet.
     * @param {boolean} [isArkivert=false] - Om kortet er for et arkivert møte.
     * @returns {HTMLElement} - Et div-element som representerer møtekortet.
     */
    function createMeetingCard(mote, isArkivert = false) {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-4 border-b last:border-b-0';

        const moteDato = new Date(mote.dato).toLocaleDateString('nb-NO', { day: '2-digit', month: 'long', year: 'numeric' });

        div.innerHTML = `
            <div>
                <p class="font-semibold text-gray-800">${mote.tittel}</p>
                <p class="text-sm text-gray-500">
                    <span>${moteDato}</span>
                    <span class="mx-2">|</span>
                    <span>${mote.sted}</span>
                    <span class="mx-2">|</span>
                    <span class="px-2 py-1 text-xs rounded-full ${isArkivert ? 'bg-gray-100 text-gray-600' : 'bg-blue-100 text-blue-800'}">${mote.status}</span>
                </p>
            </div>
            <div class="space-x-2">
                <button class="text-sm text-gray-600 hover:text-black" onclick="viewAgenda('${mote.id}')">Se saksliste</button>
                <button class="text-sm text-gray-600 hover:text-black" onclick="viewProtocol('${mote.id}')">${isArkivert ? 'Se protokoll' : 'Skriv protokoll'}</button>
            </div>
        `;
        return div;
    }

    // Placeholder-funksjoner for fremtidig bruk
    function openNewMeetingModal() { alert('Funksjonalitet for nytt møte kommer her.'); }
    function viewAgenda(moteId) { alert('Åpner saksliste for møte: ' + moteId); }
    function viewProtocol(moteId) { alert('Åpner protokoll for møte: ' + moteId); }

    // Sørger for at initialiseringen kjøres når siden lastes.
    meetingspageInit();
</script>
